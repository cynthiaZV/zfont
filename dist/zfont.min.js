/*!
 * Zfont v1.0.1
 * Text plugin for Zdog
 * 2019 James Daniel
 * MIT Licensed 
 * github.com/jaames/zfont
 */
!function(r,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(r=r||self).Zfont=t()}(this,function(){"use strict";var M={parse:function(r){var t=M._bin,e=new Uint8Array(r),a=0;t.readFixed(e,a);a+=4;var n=t.readUshort(e,a);a+=2;t.readUshort(e,a);a+=2;t.readUshort(e,a);a+=2;t.readUshort(e,a);a+=2;for(var o=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GPOS","GSUB","SVG "],s={_data:e},i={},h=0;h<n;h++){var f=t.readASCII(e,a,4);a+=4;t.readUint(e,a);a+=4;var d=t.readUint(e,a);a+=4;var u=t.readUint(e,a);a+=4,i[f]={offset:d,length:u}}for(h=0;h<o.length;h++){var l=o[h];i[l]&&(s[l.trim()]=M[l.trim()].parse(e,i[l].offset,i[l].length,s))}return s},_tabOffset:function(r,t){for(var e=M._bin,a=e.readUshort(r,4),n=12,o=0;o<a;o++){var s=e.readASCII(r,n,4);n+=4;e.readUint(r,n);n+=4;var i=e.readUint(r,n);n+=4;e.readUint(r,n);if(n+=4,s==t)return i}return 0}};M._bin={readFixed:function(r,t){return(r[t]<<8|r[t+1])+(r[t+2]<<8|r[t+3])/65540},readF2dot14:function(r,t){var e=M._bin.readShort(r,t);return e/16384},readInt:function(r,t){var e=M._bin.t.uint8;return e[0]=r[t+3],e[1]=r[t+2],e[2]=r[t+1],e[3]=r[t],M._bin.t.int32[0]},readInt8:function(r,t){return M._bin.t.uint8[0]=r[t],M._bin.t.int8[0]},readShort:function(r,t){var e=M._bin.t.uint8;return e[1]=r[t],e[0]=r[t+1],M._bin.t.int16[0]},readUshort:function(r,t){return r[t]<<8|r[t+1]},readUshorts:function(r,t,e){for(var a=[],n=0;n<e;n++)a.push(M._bin.readUshort(r,t+2*n));return a},readUint:function(r,t){var e=M._bin.t.uint8;return e[3]=r[t],e[2]=r[t+1],e[1]=r[t+2],e[0]=r[t+3],M._bin.t.uint32[0]},readUint64:function(r,t){return 4294967296*M._bin.readUint(r,t)+M._bin.readUint(r,t+4)},readASCII:function(r,t,e){for(var a="",n=0;n<e;n++)a+=String.fromCharCode(r[t+n]);return a},readUnicode:function(r,t,e){for(var a="",n=0;n<e;n++){var o=r[t++]<<8|r[t++];a+=String.fromCharCode(o)}return a},_tdec:window.TextDecoder?new window.TextDecoder:null,readUTF8:function(r,t,e){var a=M._bin._tdec;return a&&0==t&&e==r.length?a.decode(r):M._bin.readASCII(r,t,e)},readBytes:function(r,t,e){for(var a=[],n=0;n<e;n++)a.push(r[t+n]);return a},readASCIIArray:function(r,t,e){for(var a=[],n=0;n<e;n++)a.push(String.fromCharCode(r[t+n]));return a}},M._bin.t={buff:new ArrayBuffer(8)},M._bin.t.int8=new Int8Array(M._bin.t.buff),M._bin.t.uint8=new Uint8Array(M._bin.t.buff),M._bin.t.int16=new Int16Array(M._bin.t.buff),M._bin.t.uint16=new Uint16Array(M._bin.t.buff),M._bin.t.int32=new Int32Array(M._bin.t.buff),M._bin.t.uint32=new Uint32Array(M._bin.t.buff),M._lctf={},M._lctf.parse=function(r,t,e,a,n){var o=M._bin,s={},i=t;o.readFixed(r,t);t+=4;var h=o.readUshort(r,t);t+=2;var f=o.readUshort(r,t);t+=2;var d=o.readUshort(r,t);return t+=2,s.scriptList=M._lctf.readScriptList(r,i+h),s.featureList=M._lctf.readFeatureList(r,i+f),s.lookupList=M._lctf.readLookupList(r,i+d,n),s},M._lctf.readLookupList=function(r,t,e){var a=M._bin,n=t,o=[],s=a.readUshort(r,t);t+=2;for(var i=0;i<s;i++){var h=a.readUshort(r,t);t+=2;var f=M._lctf.readLookupTable(r,n+h,e);o.push(f)}return o},M._lctf.readLookupTable=function(r,t,e){var a=M._bin,n=t,o={tabs:[]};o.ltype=a.readUshort(r,t),t+=2,o.flag=a.readUshort(r,t),t+=2;var s=a.readUshort(r,t);t+=2;for(var i=0;i<s;i++){var h=a.readUshort(r,t);t+=2;var f=e(r,o.ltype,n+h);o.tabs.push(f)}return o},M._lctf.numOfOnes=function(r){for(var t=0,e=0;e<32;e++)0!=(r>>>e&1)&&t++;return t},M._lctf.readClassDef=function(r,t){var e=M._bin,a=[],n=e.readUshort(r,t);if(t+=2,1==n){var o=e.readUshort(r,t);t+=2;var s=e.readUshort(r,t);t+=2;for(var i=0;i<s;i++)a.push(o+i),a.push(o+i),a.push(e.readUshort(r,t)),t+=2}if(2==n){var h=e.readUshort(r,t);t+=2;for(i=0;i<h;i++)a.push(e.readUshort(r,t)),t+=2,a.push(e.readUshort(r,t)),t+=2,a.push(e.readUshort(r,t)),t+=2}return a},M._lctf.getInterval=function(r,t){for(var e=0;e<r.length;e+=3){var a=r[e],n=r[e+1];r[e+2];if(a<=t&&t<=n)return e}return-1},M._lctf.readValueRecord=function(r,t,e){var a=M._bin,n=[];return n.push(1&e?a.readShort(r,t):0),t+=1&e?2:0,n.push(2&e?a.readShort(r,t):0),t+=2&e?2:0,n.push(4&e?a.readShort(r,t):0),t+=4&e?2:0,n.push(8&e?a.readShort(r,t):0),t+=8&e?2:0,n},M._lctf.readCoverage=function(r,t){var e=M._bin,a={};a.fmt=e.readUshort(r,t),t+=2;var n=e.readUshort(r,t);return t+=2,1==a.fmt&&(a.tab=e.readUshorts(r,t,n)),2==a.fmt&&(a.tab=e.readUshorts(r,t,3*n)),a},M._lctf.coverageIndex=function(r,t){var e=r.tab;if(1==r.fmt)return e.indexOf(t);if(2==r.fmt){var a=M._lctf.getInterval(e,t);if(-1!=a)return e[a+2]+(t-e[a])}return-1},M._lctf.readFeatureList=function(r,t){var e=M._bin,a=t,n=[],o=e.readUshort(r,t);t+=2;for(var s=0;s<o;s++){var i=e.readASCII(r,t,4);t+=4;var h=e.readUshort(r,t);t+=2,n.push({tag:i.trim(),tab:M._lctf.readFeatureTable(r,a+h)})}return n},M._lctf.readFeatureTable=function(r,t){var e=M._bin;e.readUshort(r,t);t+=2;var a=e.readUshort(r,t);t+=2;for(var n=[],o=0;o<a;o++)n.push(e.readUshort(r,t+2*o));return n},M._lctf.readScriptList=function(r,t){var e=M._bin,a=t,n={},o=e.readUshort(r,t);t+=2;for(var s=0;s<o;s++){var i=e.readASCII(r,t,4);t+=4;var h=e.readUshort(r,t);t+=2,n[i.trim()]=M._lctf.readScriptTable(r,a+h)}return n},M._lctf.readScriptTable=function(r,t){var e=M._bin,a=t,n={},o=e.readUshort(r,t);t+=2,n.default=M._lctf.readLangSysTable(r,a+o);var s=e.readUshort(r,t);t+=2;for(var i=0;i<s;i++){var h=e.readASCII(r,t,4);t+=4;var f=e.readUshort(r,t);t+=2,n[h.trim()]=M._lctf.readLangSysTable(r,a+f)}return n},M._lctf.readLangSysTable=function(r,t){var e=M._bin,a={};e.readUshort(r,t);t+=2,a.reqFeature=e.readUshort(r,t),t+=2;var n=e.readUshort(r,t);return t+=2,a.features=e.readUshorts(r,t,n),a},M.CFF={},M.CFF.parse=function(r,t,e){var a=M._bin;(r=new Uint8Array(r.buffer,t,e))[t=0],r[++t],r[++t],r[++t];t++;var n=[];t=M.CFF.readIndex(r,t,n);for(var o=[],s=0;s<n.length-1;s++)o.push(a.readASCII(r,t+n[s],n[s+1]-n[s]));t+=n[n.length-1];var i=[];t=M.CFF.readIndex(r,t,i);var h=[];for(s=0;s<i.length-1;s++)h.push(M.CFF.readDict(r,t+i[s],t+i[s+1]));t+=i[i.length-1];var f=h[0],d=[];t=M.CFF.readIndex(r,t,d);var u=[];for(s=0;s<d.length-1;s++)u.push(a.readASCII(r,t+d[s],d[s+1]-d[s]));if(t+=d[d.length-1],M.CFF.readSubrs(r,t,f),f.CharStrings){t=f.CharStrings;d=[];t=M.CFF.readIndex(r,t,d);var l=[];for(s=0;s<d.length-1;s++)l.push(a.readBytes(r,t+d[s],d[s+1]-d[s]));f.CharStrings=l}f.Encoding&&(f.Encoding=M.CFF.readEncoding(r,f.Encoding,f.CharStrings.length)),f.charset&&(f.charset=M.CFF.readCharset(r,f.charset,f.CharStrings.length)),f.Private&&(t=f.Private[1],f.Private=M.CFF.readDict(r,t,t+f.Private[0]),f.Private.Subrs&&M.CFF.readSubrs(r,t+f.Private.Subrs,f.Private));var c={};for(var v in f)-1!=["FamilyName","FullName","Notice","version","Copyright"].indexOf(v)?c[v]=u[f[v]-426+35]:c[v]=f[v];return c},M.CFF.readSubrs=function(r,t,e){var a=M._bin,n=[];t=M.CFF.readIndex(r,t,n);var o,s=n.length;o=s<1240?107:s<33900?1131:32768,e.Bias=o,e.Subrs=[];for(var i=0;i<n.length-1;i++)e.Subrs.push(a.readBytes(r,t+n[i],n[i+1]-n[i]))},M.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],M.CFF.glyphByUnicode=function(r,t){for(var e=0;e<r.charset.length;e++)if(r.charset[e]==t)return e;return-1},M.CFF.glyphBySE=function(r,t){return t<0||255<t?-1:M.CFF.glyphByUnicode(r,M.CFF.tableSE[t])},M.CFF.readEncoding=function(r,t,e){M._bin;var a=[".notdef"],n=r[t];if(0!=n)throw"error: unknown encoding format: "+n;var o=r[++t];t++;for(var s=0;s<o;s++)a.push(r[t+s]);return a},M.CFF.readCharset=function(r,t,e){var a=M._bin,n=[".notdef"],o=r[t];if(t++,0==o)for(var s=0;s<e;s++){var i=a.readUshort(r,t);t+=2,n.push(i)}else{if(1!=o&&2!=o)throw"error: format: "+o;for(;n.length<e;){i=a.readUshort(r,t);t+=2;var h=0;1==o?(h=r[t],t++):(h=a.readUshort(r,t),t+=2);for(s=0;s<=h;s++)n.push(i),i++}}return n},M.CFF.readIndex=function(r,t,e){var a=M._bin,n=a.readUshort(r,t),o=r[t+=2];if(t++,1==o)for(var s=0;s<n+1;s++)e.push(r[t+s]);else if(2==o)for(s=0;s<n+1;s++)e.push(a.readUshort(r,t+2*s));else if(3==o)for(s=0;s<n+1;s++)e.push(16777215&a.readUint(r,t+3*s-1));else if(0!=n)throw"unsupported offset size: "+o+", count: "+n;return(t+=(n+1)*o)-1},M.CFF.getCharString=function(r,t,e){var a=M._bin,n=r[t],o=r[t+1],s=(r[t+2],r[t+3],r[t+4],1),i=null,h=null;n<=20&&(i=n,s=1),12==n&&(i=100*n+o,s=2),21<=n&&n<=27&&(i=n,s=1),28==n&&(h=a.readShort(r,t+1),s=3),29<=n&&n<=31&&(i=n,s=1),32<=n&&n<=246&&(h=n-139,s=1),247<=n&&n<=250&&(h=256*(n-247)+o+108,s=2),251<=n&&n<=254&&(h=256*-(n-251)-o-108,s=2),255==n&&(h=a.readInt(r,t+1)/65535,s=5),e.val=null!=h?h:"o"+i,e.size=s},M.CFF.readCharString=function(r,t,e){for(var a=t+e,n=M._bin,o=[];t<a;){var s=r[t],i=r[t+1],h=(r[t+2],r[t+3],r[t+4],1),f=null,d=null;s<=20&&(f=s,h=1),12==s&&(f=100*s+i,h=2),19!=s&&20!=s||(f=s,h=2),21<=s&&s<=27&&(f=s,h=1),28==s&&(d=n.readShort(r,t+1),h=3),29<=s&&s<=31&&(f=s,h=1),32<=s&&s<=246&&(d=s-139,h=1),247<=s&&s<=250&&(d=256*(s-247)+i+108,h=2),251<=s&&s<=254&&(d=256*-(s-251)-i-108,h=2),255==s&&(d=n.readInt(r,t+1)/65535,h=5),o.push(null!=d?d:"o"+f),t+=h}return o},M.CFF.readDict=function(r,t,e){for(var a=M._bin,n={},o=[];t<e;){var s=r[t],i=r[t+1],h=(r[t+2],r[t+3],r[t+4],1),f=null,d=null;if(28==s&&(d=a.readShort(r,t+1),h=3),29==s&&(d=a.readInt(r,t+1),h=5),32<=s&&s<=246&&(d=s-139,h=1),247<=s&&s<=250&&(d=256*(s-247)+i+108,h=2),251<=s&&s<=254&&(d=256*-(s-251)-i-108,h=2),255==s)throw d=a.readInt(r,t+1)/65535,h=5,"unknown number";if(30==s){var u=[];for(h=1;;){var l=r[t+h];h++;var c=l>>4,v=15&l;if(15!=c&&u.push(c),15!=v&&u.push(v),15==v)break}for(var p="",U=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],g=0;g<u.length;g++)p+=U[u[g]];d=parseFloat(p)}if(s<=21)if(f=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][s],h=1,12==s)f=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][i],h=2;null!=f?(n[f]=1==o.length?o[0]:o,o=[]):o.push(d),t+=h}return n},M.cmap={},M.cmap.parse=function(r,t,e){r=new Uint8Array(r.buffer,t,e),t=0;var a=M._bin,n={};a.readUshort(r,t);t+=2;var o=a.readUshort(r,t);t+=2;var s=[];n.tables=[];for(var i=0;i<o;i++){var h=a.readUshort(r,t);t+=2;var f=a.readUshort(r,t);t+=2;var d=a.readUint(r,t);t+=4;var u="p"+h+"e"+f,l=s.indexOf(d);if(-1==l){var c;l=n.tables.length,s.push(d);var v=a.readUshort(r,d);0==v?c=M.cmap.parse0(r,d):4==v?c=M.cmap.parse4(r,d):6==v?c=M.cmap.parse6(r,d):12==v?c=M.cmap.parse12(r,d):console.log("unknown format: "+v,h,f,d),n.tables.push(c)}if(null!=n[u])throw"multiple tables for one platform+encoding";n[u]=l}return n},M.cmap.parse0=function(r,t){var e=M._bin,a={};a.format=e.readUshort(r,t),t+=2;var n=e.readUshort(r,t);t+=2;e.readUshort(r,t);t+=2,a.map=[];for(var o=0;o<n-6;o++)a.map.push(r[t+o]);return a},M.cmap.parse4=function(r,t){var e=M._bin,a=t,n={};n.format=e.readUshort(r,t),t+=2;var o=e.readUshort(r,t);t+=2;e.readUshort(r,t);t+=2;var s=e.readUshort(r,t);t+=2;var i=s/2;n.searchRange=e.readUshort(r,t),t+=2,n.entrySelector=e.readUshort(r,t),t+=2,n.rangeShift=e.readUshort(r,t),t+=2,n.endCount=e.readUshorts(r,t,i),t+=2*i,t+=2,n.startCount=e.readUshorts(r,t,i),t+=2*i,n.idDelta=[];for(var h=0;h<i;h++)n.idDelta.push(e.readShort(r,t)),t+=2;for(n.idRangeOffset=e.readUshorts(r,t,i),t+=2*i,n.glyphIdArray=[];t<a+o;)n.glyphIdArray.push(e.readUshort(r,t)),t+=2;return n},M.cmap.parse6=function(r,t){var e=M._bin,a={};a.format=e.readUshort(r,t),t+=2;e.readUshort(r,t);t+=2;e.readUshort(r,t);t+=2,a.firstCode=e.readUshort(r,t),t+=2;var n=e.readUshort(r,t);t+=2,a.glyphIdArray=[];for(var o=0;o<n;o++)a.glyphIdArray.push(e.readUshort(r,t)),t+=2;return a},M.cmap.parse12=function(r,t){var e=M._bin,a={};a.format=e.readUshort(r,t),t+=2,t+=2;e.readUint(r,t);t+=4;e.readUint(r,t);t+=4;var n=e.readUint(r,t);t+=4,a.groups=[];for(var o=0;o<n;o++){var s=t+12*o,i=e.readUint(r,s+0),h=e.readUint(r,s+4),f=e.readUint(r,s+8);a.groups.push([i,h,f])}return a},M.glyf={},M.glyf.parse=function(r,t,e,a){for(var n=[],o=0;o<a.maxp.numGlyphs;o++)n.push(null);return n},M.glyf._parseGlyf=function(r,t){var e=M._bin,a=r._data,n=M._tabOffset(a,"glyf")+r.loca[t];if(r.loca[t]==r.loca[t+1])return null;var o={};if(o.noc=e.readShort(a,n),n+=2,o.xMin=e.readShort(a,n),n+=2,o.yMin=e.readShort(a,n),n+=2,o.xMax=e.readShort(a,n),n+=2,o.yMax=e.readShort(a,n),n+=2,o.xMin>=o.xMax||o.yMin>=o.yMax)return null;if(0<o.noc){o.endPts=[];for(var s=0;s<o.noc;s++)o.endPts.push(e.readUshort(a,n)),n+=2;var i=e.readUshort(a,n);if(n+=2,a.length-n<i)return null;o.instructions=e.readBytes(a,n,i),n+=i;var h=o.endPts[o.noc-1]+1;o.flags=[];for(s=0;s<h;s++){var f=a[n];if(n++,o.flags.push(f),0!=(8&f)){var d=a[n];n++;for(var u=0;u<d;u++)o.flags.push(f),s++}}o.xs=[];for(s=0;s<h;s++){var l=0!=(2&o.flags[s]),c=0!=(16&o.flags[s]);l?(o.xs.push(c?a[n]:-a[n]),n++):c?o.xs.push(0):(o.xs.push(e.readShort(a,n)),n+=2)}o.ys=[];for(s=0;s<h;s++){l=0!=(4&o.flags[s]),c=0!=(32&o.flags[s]);l?(o.ys.push(c?a[n]:-a[n]),n++):c?o.ys.push(0):(o.ys.push(e.readShort(a,n)),n+=2)}var v=0,p=0;for(s=0;s<h;s++)v+=o.xs[s],p+=o.ys[s],o.xs[s]=v,o.ys[s]=p}else{var U;o.parts=[];do{U=e.readUshort(a,n),n+=2;var g={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(o.parts.push(g),g.glyphIndex=e.readUshort(a,n),n+=2,1&U){var m=e.readShort(a,n);n+=2;var S=e.readShort(a,n);n+=2}else{m=e.readInt8(a,n);n++;S=e.readInt8(a,n);n++}2&U?(g.m.tx=m,g.m.ty=S):(g.p1=m,g.p2=S),8&U?(g.m.a=g.m.d=e.readF2dot14(a,n),n+=2):64&U?(g.m.a=e.readF2dot14(a,n),n+=2,g.m.d=e.readF2dot14(a,n),n+=2):128&U&&(g.m.a=e.readF2dot14(a,n),n+=2,g.m.b=e.readF2dot14(a,n),n+=2,g.m.c=e.readF2dot14(a,n),n+=2,g.m.d=e.readF2dot14(a,n),n+=2)}while(32&U);if(256&U){var b=e.readUshort(a,n);n+=2,o.instr=[];for(s=0;s<b;s++)o.instr.push(a[n]),n++}}return o},M.GPOS={},M.GPOS.parse=function(r,t,e,a){return M._lctf.parse(r,t,e,a,M.GPOS.subt)},M.GPOS.subt=function(r,t,e){if(2!=t)return null;var a=M._bin,n=e,o={};o.format=a.readUshort(r,e),e+=2;var s=a.readUshort(r,e);e+=2,o.coverage=M._lctf.readCoverage(r,s+n),o.valFmt1=a.readUshort(r,e),e+=2,o.valFmt2=a.readUshort(r,e),e+=2;var i=M._lctf.numOfOnes(o.valFmt1),h=M._lctf.numOfOnes(o.valFmt2);if(1==o.format){o.pairsets=[];var f=a.readUshort(r,e);e+=2;for(var d=0;d<f;d++){var u=a.readUshort(r,e);e+=2,u+=n;var l=a.readUshort(r,u);u+=2;for(var c=[],v=0;v<l;v++){var p=a.readUshort(r,u);u+=2,0!=o.valFmt1&&(y=M._lctf.readValueRecord(r,u,o.valFmt1),u+=2*i),0!=o.valFmt2&&(_=M._lctf.readValueRecord(r,u,o.valFmt2),u+=2*h),c.push({gid2:p,val1:y,val2:_})}o.pairsets.push(c)}}if(2==o.format){var U=a.readUshort(r,e);e+=2;var g=a.readUshort(r,e);e+=2;var m=a.readUshort(r,e);e+=2;var S=a.readUshort(r,e);e+=2,o.classDef1=M._lctf.readClassDef(r,n+U),o.classDef2=M._lctf.readClassDef(r,n+g),o.matrix=[];for(d=0;d<m;d++){var b=[];for(v=0;v<S;v++){var y=null,_=null;0!=o.valFmt1&&(y=M._lctf.readValueRecord(r,e,o.valFmt1),e+=2*i),0!=o.valFmt2&&(_=M._lctf.readValueRecord(r,e,o.valFmt2),e+=2*h),b.push({val1:y,val2:_})}o.matrix.push(b)}}return o},M.GSUB={},M.GSUB.parse=function(r,t,e,a){return M._lctf.parse(r,t,e,a,M.GSUB.subt)},M.GSUB.subt=function(r,t,e){var a=M._bin,n=e,o={};if(1!=t&&4!=t&&5!=t)return null;o.fmt=a.readUshort(r,e),e+=2;var s=a.readUshort(r,e);if(e+=2,o.coverage=M._lctf.readCoverage(r,s+n),1==t){if(1==o.fmt)o.delta=a.readShort(r,e),e+=2;else if(2==o.fmt){var i=a.readUshort(r,e);e+=2,o.newg=a.readUshorts(r,e,i),e+=2*o.newg.length}}else if(4==t){o.vals=[];i=a.readUshort(r,e);e+=2;for(var h=0;h<i;h++){var f=a.readUshort(r,e);e+=2,o.vals.push(M.GSUB.readLigatureSet(r,n+f))}}else if(5==t)if(2==o.fmt){var d=a.readUshort(r,e);e+=2,o.cDef=M._lctf.readClassDef(r,n+d),o.scset=[];var u=a.readUshort(r,e);e+=2;for(h=0;h<u;h++){var l=a.readUshort(r,e);e+=2,o.scset.push(0==l?null:M.GSUB.readSubClassSet(r,n+l))}}else console.log("unknown table format",o.fmt);return o},M.GSUB.readSubClassSet=function(r,t){var e=M._bin.readUshort,a=t,n=[],o=e(r,t);t+=2;for(var s=0;s<o;s++){var i=e(r,t);t+=2,n.push(M.GSUB.readSubClassRule(r,a+i))}return n},M.GSUB.readSubClassRule=function(r,t){var e=M._bin.readUshort,a={},n=e(r,t),o=e(r,t+=2);t+=2,a.input=[];for(var s=0;s<n-1;s++)a.input.push(e(r,t)),t+=2;return a.substLookupRecords=M.GSUB.readSubstLookupRecords(r,t,o),a},M.GSUB.readSubstLookupRecords=function(r,t,e){for(var a=M._bin.readUshort,n=[],o=0;o<e;o++)n.push(a(r,t),a(r,t+2)),t+=4;return n},M.GSUB.readChainSubClassSet=function(r,t){var e=M._bin,a=t,n=[],o=e.readUshort(r,t);t+=2;for(var s=0;s<o;s++){var i=e.readUshort(r,t);t+=2,n.push(M.GSUB.readChainSubClassRule(r,a+i))}return n},M.GSUB.readChainSubClassRule=function(r,t){for(var e=M._bin,a={},n=["backtrack","input","lookahead"],o=0;o<n.length;o++){var s=e.readUshort(r,t);t+=2,1==o&&s--,a[n[o]]=e.readUshorts(r,t,s),t+=2*a[n[o]].length}s=e.readUshort(r,t);return t+=2,a.subst=e.readUshorts(r,t,2*s),t+=2*a.subst.length,a},M.GSUB.readLigatureSet=function(r,t){var e=M._bin,a=t,n=[],o=e.readUshort(r,t);t+=2;for(var s=0;s<o;s++){var i=e.readUshort(r,t);t+=2,n.push(M.GSUB.readLigature(r,a+i))}return n},M.GSUB.readLigature=function(r,t){var e=M._bin,a={chain:[]};a.nglyph=e.readUshort(r,t),t+=2;var n=e.readUshort(r,t);t+=2;for(var o=0;o<n-1;o++)a.chain.push(e.readUshort(r,t)),t+=2;return a},M.head={},M.head.parse=function(r,t,e){var a=M._bin,n={};a.readFixed(r,t);t+=4,n.fontRevision=a.readFixed(r,t),t+=4;a.readUint(r,t);t+=4;a.readUint(r,t);return t+=4,n.flags=a.readUshort(r,t),t+=2,n.unitsPerEm=a.readUshort(r,t),t+=2,n.created=a.readUint64(r,t),t+=8,n.modified=a.readUint64(r,t),t+=8,n.xMin=a.readShort(r,t),t+=2,n.yMin=a.readShort(r,t),t+=2,n.xMax=a.readShort(r,t),t+=2,n.yMax=a.readShort(r,t),t+=2,n.macStyle=a.readUshort(r,t),t+=2,n.lowestRecPPEM=a.readUshort(r,t),t+=2,n.fontDirectionHint=a.readShort(r,t),t+=2,n.indexToLocFormat=a.readShort(r,t),t+=2,n.glyphDataFormat=a.readShort(r,t),t+=2,n},M.hhea={},M.hhea.parse=function(r,t,e){var a=M._bin,n={};a.readFixed(r,t);return t+=4,n.ascender=a.readShort(r,t),t+=2,n.descender=a.readShort(r,t),t+=2,n.lineGap=a.readShort(r,t),t+=2,n.advanceWidthMax=a.readUshort(r,t),t+=2,n.minLeftSideBearing=a.readShort(r,t),t+=2,n.minRightSideBearing=a.readShort(r,t),t+=2,n.xMaxExtent=a.readShort(r,t),t+=2,n.caretSlopeRise=a.readShort(r,t),t+=2,n.caretSlopeRun=a.readShort(r,t),t+=2,n.caretOffset=a.readShort(r,t),t+=2,t+=8,n.metricDataFormat=a.readShort(r,t),t+=2,n.numberOfHMetrics=a.readUshort(r,t),t+=2,n},M.hmtx={},M.hmtx.parse=function(r,t,e,a){for(var n=M._bin,o={aWidth:[],lsBearing:[]},s=0,i=0,h=0;h<a.maxp.numGlyphs;h++)h<a.hhea.numberOfHMetrics&&(s=n.readUshort(r,t),t+=2,i=n.readShort(r,t),t+=2),o.aWidth.push(s),o.lsBearing.push(i);return o},M.kern={},M.kern.parse=function(r,t,e,a){var n=M._bin,o=n.readUshort(r,t);if(t+=2,1==o)return M.kern.parseV1(r,t-2,e,a);var s=n.readUshort(r,t);t+=2;for(var i={glyph1:[],rval:[]},h=0;h<s;h++){t+=2;e=n.readUshort(r,t);t+=2;var f=n.readUshort(r,t);t+=2;var d=f>>>8;if(0!=(d&=15))throw"unknown kern table format: "+d;t=M.kern.readFormat0(r,t,i)}return i},M.kern.parseV1=function(r,t,e,a){var n=M._bin;n.readFixed(r,t);t+=4;var o=n.readUint(r,t);t+=4;for(var s={glyph1:[],rval:[]},i=0;i<o;i++){n.readUint(r,t);t+=4;var h=n.readUshort(r,t);t+=2;n.readUshort(r,t);t+=2;var f=h>>>8;if(0!=(f&=15))throw"unknown kern table format: "+f;t=M.kern.readFormat0(r,t,s)}return s},M.kern.readFormat0=function(r,t,e){var a=M._bin,n=-1,o=a.readUshort(r,t);t+=2;a.readUshort(r,t);t+=2;a.readUshort(r,t);t+=2;a.readUshort(r,t);t+=2;for(var s=0;s<o;s++){var i=a.readUshort(r,t);t+=2;var h=a.readUshort(r,t);t+=2;var f=a.readShort(r,t);t+=2,i!=n&&(e.glyph1.push(i),e.rval.push({glyph2:[],vals:[]}));var d=e.rval[e.rval.length-1];d.glyph2.push(h),d.vals.push(f),n=i}return t},M.loca={},M.loca.parse=function(r,t,e,a){var n=M._bin,o=[],s=a.head.indexToLocFormat,i=a.maxp.numGlyphs+1;if(0==s)for(var h=0;h<i;h++)o.push(n.readUshort(r,t+(h<<1))<<1);if(1==s)for(h=0;h<i;h++)o.push(n.readUint(r,t+(h<<2)));return o},M.maxp={},M.maxp.parse=function(r,t,e){var a=M._bin,n={},o=a.readUint(r,t);return t+=4,n.numGlyphs=a.readUshort(r,t),t+=2,65536==o&&(n.maxPoints=a.readUshort(r,t),t+=2,n.maxContours=a.readUshort(r,t),t+=2,n.maxCompositePoints=a.readUshort(r,t),t+=2,n.maxCompositeContours=a.readUshort(r,t),t+=2,n.maxZones=a.readUshort(r,t),t+=2,n.maxTwilightPoints=a.readUshort(r,t),t+=2,n.maxStorage=a.readUshort(r,t),t+=2,n.maxFunctionDefs=a.readUshort(r,t),t+=2,n.maxInstructionDefs=a.readUshort(r,t),t+=2,n.maxStackElements=a.readUshort(r,t),t+=2,n.maxSizeOfInstructions=a.readUshort(r,t),t+=2,n.maxComponentElements=a.readUshort(r,t),t+=2,n.maxComponentDepth=a.readUshort(r,t),t+=2),n},M.name={},M.name.parse=function(r,t,e){var a=M._bin,n={};a.readUshort(r,t);t+=2;var o=a.readUshort(r,t);t+=2;a.readUshort(r,t);for(var s,i=t+=2,h=0;h<o;h++){var f=a.readUshort(r,t);t+=2;var d=a.readUshort(r,t);t+=2;var u=a.readUshort(r,t);t+=2;var l=a.readUshort(r,t);t+=2;e=a.readUshort(r,t);t+=2;var c=a.readUshort(r,t);t+=2;var v="p"+f;null==n[v]&&(n[v]={});var p,U=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"][l],g=i+12*o+c;if(0==f)p=a.readUnicode(r,g,e/2);else if(3==f&&0==d)p=a.readUnicode(r,g,e/2);else if(0==d)p=a.readASCII(r,g,e);else if(1==d)p=a.readUnicode(r,g,e/2);else if(3==d)p=a.readUnicode(r,g,e/2);else{if(1!=f)throw"unknown encoding "+d+", platformID: "+f;p=a.readASCII(r,g,e),console.log("reading unknown MAC encoding "+d+" as ASCII")}n[v][U]=p,n[v]._lang=u}for(var m in n)if(null!=n[m].postScriptName&&1033==n[m]._lang)return n[m];for(var m in n)if(null!=n[m].postScriptName&&3084==n[m]._lang)return n[m];for(var m in n)if(null!=n[m].postScriptName)return n[m];for(var m in n){s=m;break}return console.log("returning name table with languageID "+n[s]._lang),n[s]},M["OS/2"]={},M["OS/2"].parse=function(r,t,e){var a=M._bin.readUshort(r,t);t+=2;var n={};if(0==a)M["OS/2"].version0(r,t,n);else if(1==a)M["OS/2"].version1(r,t,n);else if(2==a||3==a||4==a)M["OS/2"].version2(r,t,n);else{if(5!=a)throw"unknown OS/2 table version: "+a;M["OS/2"].version5(r,t,n)}return n},M["OS/2"].version0=function(r,t,e){var a=M._bin;return e.xAvgCharWidth=a.readShort(r,t),t+=2,e.usWeightClass=a.readUshort(r,t),t+=2,e.usWidthClass=a.readUshort(r,t),t+=2,e.fsType=a.readUshort(r,t),t+=2,e.ySubscriptXSize=a.readShort(r,t),t+=2,e.ySubscriptYSize=a.readShort(r,t),t+=2,e.ySubscriptXOffset=a.readShort(r,t),t+=2,e.ySubscriptYOffset=a.readShort(r,t),t+=2,e.ySuperscriptXSize=a.readShort(r,t),t+=2,e.ySuperscriptYSize=a.readShort(r,t),t+=2,e.ySuperscriptXOffset=a.readShort(r,t),t+=2,e.ySuperscriptYOffset=a.readShort(r,t),t+=2,e.yStrikeoutSize=a.readShort(r,t),t+=2,e.yStrikeoutPosition=a.readShort(r,t),t+=2,e.sFamilyClass=a.readShort(r,t),t+=2,e.panose=a.readBytes(r,t,10),t+=10,e.ulUnicodeRange1=a.readUint(r,t),t+=4,e.ulUnicodeRange2=a.readUint(r,t),t+=4,e.ulUnicodeRange3=a.readUint(r,t),t+=4,e.ulUnicodeRange4=a.readUint(r,t),t+=4,e.achVendID=[a.readInt8(r,t),a.readInt8(r,t+1),a.readInt8(r,t+2),a.readInt8(r,t+3)],t+=4,e.fsSelection=a.readUshort(r,t),t+=2,e.usFirstCharIndex=a.readUshort(r,t),t+=2,e.usLastCharIndex=a.readUshort(r,t),t+=2,e.sTypoAscender=a.readShort(r,t),t+=2,e.sTypoDescender=a.readShort(r,t),t+=2,e.sTypoLineGap=a.readShort(r,t),t+=2,e.usWinAscent=a.readUshort(r,t),t+=2,e.usWinDescent=a.readUshort(r,t),t+=2},M["OS/2"].version1=function(r,t,e){var a=M._bin;return t=M["OS/2"].version0(r,t,e),e.ulCodePageRange1=a.readUint(r,t),t+=4,e.ulCodePageRange2=a.readUint(r,t),t+=4},M["OS/2"].version2=function(r,t,e){var a=M._bin;return t=M["OS/2"].version1(r,t,e),e.sxHeight=a.readShort(r,t),t+=2,e.sCapHeight=a.readShort(r,t),t+=2,e.usDefault=a.readUshort(r,t),t+=2,e.usBreak=a.readUshort(r,t),t+=2,e.usMaxContext=a.readUshort(r,t),t+=2},M["OS/2"].version5=function(r,t,e){var a=M._bin;return t=M["OS/2"].version2(r,t,e),e.usLowerOpticalPointSize=a.readUshort(r,t),t+=2,e.usUpperOpticalPointSize=a.readUshort(r,t),t+=2},M.post={},M.post.parse=function(r,t,e){var a=M._bin,n={};return n.version=a.readFixed(r,t),t+=4,n.italicAngle=a.readFixed(r,t),t+=4,n.underlinePosition=a.readShort(r,t),t+=2,n.underlineThickness=a.readShort(r,t),t+=2,n},M.SVG={},M.SVG.parse=function(r,t,e){var a=M._bin,n={entries:[]},o=t;a.readUshort(r,t);t+=2;var s=a.readUint(r,t);t+=4;a.readUint(r,t);t+=4,t=s+o;var i=a.readUshort(r,t);t+=2;for(var h=0;h<i;h++){var f=a.readUshort(r,t);t+=2;var d=a.readUshort(r,t);t+=2;var u=a.readUint(r,t);t+=4;var l=a.readUint(r,t);t+=4;for(var c=new Uint8Array(r.buffer,o+u+s,l),v=a.readUTF8(c,0,c.length),p=f;p<=d;p++)n.entries[p]=v}return n},M.SVG.toPath=function(r){var t={cmds:[],crds:[]};if(null==r)return t;for(var e=(new DOMParser).parseFromString(r,"image/svg+xml").firstChild;"svg"!=e.tagName;)e=e.nextSibling;var a=e.getAttribute("viewBox");a=a?a.trim().split(" ").map(parseFloat):[0,0,1e3,1e3],M.SVG._toPath(e.children,t);for(var n=0;n<t.crds.length;n+=2){var o=t.crds[n],s=t.crds[n+1];o-=a[0],s=-(s-=a[1]),t.crds[n]=o,t.crds[n+1]=s}return t},M.SVG._toPath=function(r,t,e){for(var a=0;a<r.length;a++){var n=r[a],o=n.tagName,s=n.getAttribute("fill");if(null==s&&(s=e),"g"==o)M.SVG._toPath(n.children,t,s);else if("path"==o){t.cmds.push(s||"#000000");var i=n.getAttribute("d"),h=M.SVG._tokens(i);M.SVG._toksToPath(h,t),t.cmds.push("X")}else"defs"==o||console.log(o,n)}},M.SVG._tokens=function(r){for(var t=[],e=0,a=!1,n="";e<r.length;){var o=r.charCodeAt(e),s=r.charAt(e);e++;var i=48<=o&&o<=57||"."==s||"-"==s;a?"-"==s?(t.push(parseFloat(n)),n=s):i?n+=s:(t.push(parseFloat(n)),","!=s&&" "!=s&&t.push(s),a=!1):i?(n=s,a=!0):","!=s&&" "!=s&&t.push(s)}return a&&t.push(parseFloat(n)),t},M.SVG._toksToPath=function(r,t){for(var e=0,a=0,n=0,o=0,s=0,i={M:2,L:2,H:1,V:1,S:4,C:6},h=t.cmds,f=t.crds;e<r.length;){var d=r[e];if(e++,"z"==d)h.push("Z"),a=o,n=s;else for(var u=d.toUpperCase(),l=i[u],c=M.SVG._reps(r,e,l),v=0;v<c;v++){var p=0,U=0;if(d!=u&&(p=a,U=n),"M"==u)a=p+r[e++],n=U+r[e++],h.push("M"),f.push(a,n),o=a,s=n;else if("L"==u)a=p+r[e++],n=U+r[e++],h.push("L"),f.push(a,n);else if("H"==u)a=p+r[e++],h.push("L"),f.push(a,n);else if("V"==u)n=U+r[e++],h.push("L"),f.push(a,n);else if("C"==u){var g=p+r[e++],m=U+r[e++],S=p+r[e++],b=U+r[e++],y=p+r[e++],_=U+r[e++];h.push("C"),f.push(g,m,S,b,y,_),a=y,n=_}else if("S"==u){var F=Math.max(f.length-4,0);g=a+a-f[F],m=n+n-f[F+1],S=p+r[e++],b=U+r[e++],y=p+r[e++],_=U+r[e++];h.push("C"),f.push(g,m,S,b,y,_),a=y,n=_}else console.log("Unknown SVG command "+d)}}},M.SVG._reps=function(r,t,e){for(var a=t;a<r.length&&"string"!=typeof r[a];)a+=e;return(a-t)/e},null==M&&(M={}),null==M.U&&(M.U={}),M.U.codeToGlyph=function(r,t){var e=r.cmap,a=-1;if(null!=e.p0e4?a=e.p0e4:null!=e.p3e1?a=e.p3e1:null!=e.p1e0&&(a=e.p1e0),-1==a)throw"no familiar platform and encoding!";var n=e.tables[a];if(0==n.format)return t>=n.map.length?0:n.map[t];if(4==n.format){for(var o=-1,s=0;s<n.endCount.length;s++)if(t<=n.endCount[s]){o=s;break}if(-1==o)return 0;if(n.startCount[o]>t)return 0;return 65535&(0!=n.idRangeOffset[o]?n.glyphIdArray[t-n.startCount[o]+(n.idRangeOffset[o]>>1)-(n.idRangeOffset.length-o)]:t+n.idDelta[o])}if(12!=n.format)throw"unknown cmap table format "+n.format;if(t>n.groups[n.groups.length-1][1])return 0;for(s=0;s<n.groups.length;s++){var i=n.groups[s];if(i[0]<=t&&t<=i[1])return i[2]+(t-i[0])}return 0},M.U.glyphToPath=function(r,t){var e={cmds:[],crds:[]};if(r.SVG&&r.SVG.entries[t]){var a=r.SVG.entries[t];return null==a?e:("string"==typeof a&&(a=M.SVG.toPath(a),r.SVG.entries[t]=a),a)}if(r.CFF){var n={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:r.CFF.Private?r.CFF.Private.defaultWidthX:0,open:!1};M.U._drawCFF(r.CFF.CharStrings[t],n,r.CFF,e)}else r.glyf&&M.U._drawGlyf(t,r,e);return e},M.U._drawGlyf=function(r,t,e){var a=t.glyf[r];null==a&&(a=t.glyf[r]=M.glyf._parseGlyf(t,r)),null!=a&&(-1<a.noc?M.U._simpleGlyph(a,e):M.U._compoGlyph(a,t,e))},M.U._simpleGlyph=function(r,t){for(var e=0;e<r.noc;e++){for(var a=0==e?0:r.endPts[e-1]+1,n=r.endPts[e],o=a;o<=n;o++){var s=o==a?n:o-1,i=o==n?a:o+1,h=1&r.flags[o],f=1&r.flags[s],d=1&r.flags[i],u=r.xs[o],l=r.ys[o];if(o==a)if(h){if(!f){M.U.P.moveTo(t,u,l);continue}M.U.P.moveTo(t,r.xs[s],r.ys[s])}else f?M.U.P.moveTo(t,r.xs[s],r.ys[s]):M.U.P.moveTo(t,(r.xs[s]+u)/2,(r.ys[s]+l)/2);h?f&&M.U.P.lineTo(t,u,l):d?M.U.P.qcurveTo(t,u,l,r.xs[i],r.ys[i]):M.U.P.qcurveTo(t,u,l,(u+r.xs[i])/2,(l+r.ys[i])/2)}M.U.P.closePath(t)}},M.U._compoGlyph=function(r,t,e){for(var a=0;a<r.parts.length;a++){var n={cmds:[],crds:[]},o=r.parts[a];M.U._drawGlyf(o.glyphIndex,t,n);for(var s=o.m,i=0;i<n.crds.length;i+=2){var h=n.crds[i],f=n.crds[i+1];e.crds.push(h*s.a+f*s.b+s.tx),e.crds.push(h*s.c+f*s.d+s.ty)}for(i=0;i<n.cmds.length;i++)e.cmds.push(n.cmds[i])}},M.U._getGlyphClass=function(r,t){var e=M._lctf.getInterval(t,r);return-1==e?0:t[e+2]},M.U.getPairAdjustment=function(r,t,e){if(r.GPOS){for(var a=null,n=0;n<r.GPOS.featureList.length;n++){var o=r.GPOS.featureList[n];if("kern"==o.tag)for(var s=0;s<o.tab.length;s++)2==r.GPOS.lookupList[o.tab[s]].ltype&&(a=r.GPOS.lookupList[o.tab[s]])}if(a)for(n=0;n<a.tabs.length;n++){var i=a.tabs[n],h=M._lctf.coverageIndex(i.coverage,t);if(-1!=h){if(1==i.format){var f=i.pairsets[h];for(s=0;s<f.length;s++)f[s].gid2==e&&(l=f[s]);if(null==l)continue}else if(2==i.format)var d=M.U._getGlyphClass(t,i.classDef1),u=M.U._getGlyphClass(e,i.classDef2),l=i.matrix[d][u];return l.val1[2]}}}if(r.kern){var c=r.kern.glyph1.indexOf(t);if(-1!=c){var v=r.kern.rval[c].glyph2.indexOf(e);if(-1!=v)return r.kern.rval[c].vals[v]}}return 0},M.U.stringToGlyphs=function(r,t){for(var e=[],a=0;a<t.length;a++){var n=t.codePointAt(a);65535<n&&a++,e.push(M.U.codeToGlyph(r,n))}var o=r.GSUB;if(null==o)return e;for(var s=o.lookupList,i=o.featureList,h='\n\t" ,.:;!?()  ،',f="آأؤإاةدذرزوٱٲٳٵٶٷڈډڊڋڌڍڎڏڐڑڒړڔڕږڗژڙۀۃۄۅۆۇۈۉۊۋۍۏےۓەۮۯܐܕܖܗܘܙܞܨܪܬܯݍݙݚݛݫݬݱݳݴݸݹࡀࡆࡇࡉࡔࡧࡩࡪࢪࢫࢬࢮࢱࢲࢹૅેૉ૊૎૏ૐ૑૒૝ૡ૤૯஁ஃ஄அஉ஌எஏ஑னப஫஬",d=0;d<e.length;d++){var u=e[d],l=0==d||-1!=h.indexOf(t[d-1]),c=d==e.length-1||-1!=h.indexOf(t[d+1]);l||-1==f.indexOf(t[d-1])||(l=!0),c||-1==f.indexOf(t[d])||(c=!0),c||-1=="ꡲ્૗".indexOf(t[d+1])||(c=!0),l||-1=="ꡲ્૗".indexOf(t[d])||(l=!0);var v=null;v=l?c?"isol":"init":c?"fina":"medi";for(var p=0;p<i.length;p++)if(i[p].tag==v)for(var U=0;U<i[p].tab.length;U++){1==(b=s[i[p].tab[U]]).ltype&&M.U._applyType1(e,d,b)}}var g=["rlig","liga","mset"];for(d=0;d<e.length;d++){u=e[d];var m=Math.min(3,e.length-d-1);for(p=0;p<i.length;p++){var S=i[p];if(-1!=g.indexOf(S.tag))for(U=0;U<S.tab.length;U++)for(var b=s[S.tab[U]],y=0;y<b.tabs.length;y++)if(null!=b.tabs[y]){var _=M._lctf.coverageIndex(b.tabs[y].coverage,u);if(-1!=_)if(4==b.ltype)for(var F=b.tabs[y].vals[_],x=0;x<F.length;x++){var C=F[x],P=C.chain.length;if(!(m<P)){for(var T=!0,w=0;w<P;w++)C.chain[w]!=e[d+(1+w)]&&(T=!1);if(T){e[d]=C.nglyph;for(w=0;w<P;w++)e[d+w+1]=-1}}}else if(5==b.ltype){var I=b.tabs[y];if(2!=I.fmt)continue;var G=M._lctf.getInterval(I.cDef,u),O=I.cDef[G+2],k=I.scset[O];for(a=0;a<k.length;a++){var L=k[a],A=L.input;if(!(A.length>m)){for(T=!0,w=0;w<A.length;w++){var B=M._lctf.getInterval(I.cDef,e[d+1+w]);if(-1==G&&I.cDef[B+2]!=A[w]){T=!1;break}}if(T){var D=L.substLookupRecords;for(x=0;x<D.length;x+=2)D[x],D[x+1]}}}}}}}return e},M.U._applyType1=function(r,t,e){for(var a=r[t],n=0;n<e.tabs.length;n++){var o=e.tabs[n],s=M._lctf.coverageIndex(o.coverage,a);-1!=s&&(1==o.fmt?r[t]=r[t]+o.delta:r[t]=o.newg[s])}},M.U.glyphsToPath=function(r,t,e){for(var a={cmds:[],crds:[]},n=0,o=0;o<t.length;o++){var s=t[o];if(-1!=s){for(var i=o<t.length-1&&-1!=t[o+1]?t[o+1]:0,h=M.U.glyphToPath(r,s),f=0;f<h.crds.length;f+=2)a.crds.push(h.crds[f]+n),a.crds.push(h.crds[f+1]);e&&a.cmds.push(e);for(f=0;f<h.cmds.length;f++)a.cmds.push(h.cmds[f]);e&&a.cmds.push("X"),n+=r.hmtx.aWidth[s],o<t.length-1&&(n+=M.U.getPairAdjustment(r,s,i))}}return a},M.U.pathToSVG=function(r,t){null==t&&(t=5);for(var e=[],a=0,n={M:2,L:2,Q:4,C:6},o=0;o<r.cmds.length;o++){var s=r.cmds[o],i=a+(n[s]?n[s]:0);for(e.push(s);a<i;){var h=r.crds[a++];e.push(parseFloat(h.toFixed(t))+(a==i?"":" "))}}return e.join("")},M.U.pathToContext=function(r,t){for(var e=0,a=r.crds,n=0;n<r.cmds.length;n++){var o=r.cmds[n];"M"==o?(t.moveTo(a[e],a[e+1]),e+=2):"L"==o?(t.lineTo(a[e],a[e+1]),e+=2):"C"==o?(t.bezierCurveTo(a[e],a[e+1],a[e+2],a[e+3],a[e+4],a[e+5]),e+=6):"Q"==o?(t.quadraticCurveTo(a[e],a[e+1],a[e+2],a[e+3]),e+=4):"#"==o.charAt(0)?(t.beginPath(),t.fillStyle=o):"Z"==o?t.closePath():"X"==o&&t.fill()}},M.U.P={},M.U.P.moveTo=function(r,t,e){r.cmds.push("M"),r.crds.push(t,e)},M.U.P.lineTo=function(r,t,e){r.cmds.push("L"),r.crds.push(t,e)},M.U.P.curveTo=function(r,t,e,a,n,o,s){r.cmds.push("C"),r.crds.push(t,e,a,n,o,s)},M.U.P.qcurveTo=function(r,t,e,a,n){r.cmds.push("Q"),r.crds.push(t,e,a,n)},M.U.P.closePath=function(r){r.cmds.push("Z")},M.U._drawCFF=function(r,t,e,a){for(var n=t.stack,o=t.nStems,s=t.haveWidth,i=t.width,h=t.open,f=0,d=t.x,u=t.y,l=0,c=0,v=0,p=0,U=0,g=0,m=0,S=0,b=0,y=0,_={val:0,size:0};f<r.length;){M.CFF.getCharString(r,f,_);var F=_.val;if(f+=_.size,"o1"==F||"o18"==F)n.length%2!=0&&!s&&(i=n.shift()+e.Private.nominalWidthX),o+=n.length>>1,s=!(n.length=0);else if("o3"==F||"o23"==F){n.length%2!=0&&!s&&(i=n.shift()+e.Private.nominalWidthX),o+=n.length>>1,s=!(n.length=0)}else if("o4"==F)1<n.length&&!s&&(i=n.shift()+e.Private.nominalWidthX,s=!0),h&&M.U.P.closePath(a),u+=n.pop(),M.U.P.moveTo(a,d,u),h=!0;else if("o5"==F)for(;0<n.length;)d+=n.shift(),u+=n.shift(),M.U.P.lineTo(a,d,u);else if("o6"==F||"o7"==F)for(var x=n.length,C="o6"==F,P=0;P<x;P++){var T=n.shift();C?d+=T:u+=T,C=!C,M.U.P.lineTo(a,d,u)}else if("o8"==F||"o24"==F){x=n.length;for(var w=0;w+6<=x;)l=d+n.shift(),c=u+n.shift(),v=l+n.shift(),p=c+n.shift(),d=v+n.shift(),u=p+n.shift(),M.U.P.curveTo(a,l,c,v,p,d,u),w+=6;"o24"==F&&(d+=n.shift(),u+=n.shift(),M.U.P.lineTo(a,d,u))}else{if("o11"==F)break;if("o1234"==F||"o1235"==F||"o1236"==F||"o1237"==F)"o1234"==F&&(c=u,v=(l=d+n.shift())+n.shift(),g=y=p=c+n.shift(),S=u,d=(m=(U=(b=v+n.shift())+n.shift())+n.shift())+n.shift(),M.U.P.curveTo(a,l,c,v,p,b,y),M.U.P.curveTo(a,U,g,m,S,d,u)),"o1235"==F&&(l=d+n.shift(),c=u+n.shift(),v=l+n.shift(),p=c+n.shift(),b=v+n.shift(),y=p+n.shift(),U=b+n.shift(),g=y+n.shift(),m=U+n.shift(),S=g+n.shift(),d=m+n.shift(),u=S+n.shift(),n.shift(),M.U.P.curveTo(a,l,c,v,p,b,y),M.U.P.curveTo(a,U,g,m,S,d,u)),"o1236"==F&&(l=d+n.shift(),c=u+n.shift(),v=l+n.shift(),g=y=p=c+n.shift(),m=(U=(b=v+n.shift())+n.shift())+n.shift(),S=g+n.shift(),d=m+n.shift(),M.U.P.curveTo(a,l,c,v,p,b,y),M.U.P.curveTo(a,U,g,m,S,d,u)),"o1237"==F&&(l=d+n.shift(),c=u+n.shift(),v=l+n.shift(),p=c+n.shift(),b=v+n.shift(),y=p+n.shift(),U=b+n.shift(),g=y+n.shift(),m=U+n.shift(),S=g+n.shift(),Math.abs(m-d)>Math.abs(S-u)?d=m+n.shift():u=S+n.shift(),M.U.P.curveTo(a,l,c,v,p,b,y),M.U.P.curveTo(a,U,g,m,S,d,u));else if("o14"==F){if(0<n.length&&!s&&(i=n.shift()+e.nominalWidthX,s=!0),4==n.length){var I=n.shift(),G=n.shift(),O=n.shift(),k=n.shift(),L=M.CFF.glyphBySE(e,O),A=M.CFF.glyphBySE(e,k);M.U._drawCFF(e.CharStrings[L],t,e,a),t.x=I,t.y=G,M.U._drawCFF(e.CharStrings[A],t,e,a)}h&&(M.U.P.closePath(a),h=!1)}else if("o19"==F||"o20"==F){n.length%2!=0&&!s&&(i=n.shift()+e.Private.nominalWidthX),o+=n.length>>1,s=!(n.length=0),f+=o+7>>3}else if("o21"==F)2<n.length&&!s&&(i=n.shift()+e.Private.nominalWidthX,s=!0),u+=n.pop(),d+=n.pop(),h&&M.U.P.closePath(a),M.U.P.moveTo(a,d,u),h=!0;else if("o22"==F)1<n.length&&!s&&(i=n.shift()+e.Private.nominalWidthX,s=!0),d+=n.pop(),h&&M.U.P.closePath(a),M.U.P.moveTo(a,d,u),h=!0;else if("o25"==F){for(;6<n.length;)d+=n.shift(),u+=n.shift(),M.U.P.lineTo(a,d,u);l=d+n.shift(),c=u+n.shift(),v=l+n.shift(),p=c+n.shift(),d=v+n.shift(),u=p+n.shift(),M.U.P.curveTo(a,l,c,v,p,d,u)}else if("o26"==F)for(n.length%2&&(d+=n.shift());0<n.length;)l=d,c=u+n.shift(),d=v=l+n.shift(),u=(p=c+n.shift())+n.shift(),M.U.P.curveTo(a,l,c,v,p,d,u);else if("o27"==F)for(n.length%2&&(u+=n.shift());0<n.length;)c=u,v=(l=d+n.shift())+n.shift(),p=c+n.shift(),d=v+n.shift(),u=p,M.U.P.curveTo(a,l,c,v,p,d,u);else if("o10"==F||"o29"==F){var B="o10"==F?e.Private:e;if(0==n.length)console.log("error: empty stack");else{var D=n.pop(),R=B.Subrs[D+B.Bias];t.x=d,t.y=u,t.nStems=o,t.haveWidth=s,t.width=i,t.open=h,M.U._drawCFF(R,t,e,a),d=t.x,u=t.y,o=t.nStems,s=t.haveWidth,i=t.width,h=t.open}}else if("o30"==F||"o31"==F){var z=n.length,V=(w=0,"o31"==F);for(w+=z-(x=-3&z);w<x;)V=V?(c=u,v=(l=d+n.shift())+n.shift(),u=(p=c+n.shift())+n.shift(),x-w==5?(d=v+n.shift(),w++):d=v,!1):(l=d,c=u+n.shift(),v=l+n.shift(),p=c+n.shift(),d=v+n.shift(),x-w==5?(u=p+n.shift(),w++):u=p,!0),M.U.P.curveTo(a,l,c,v,p,d,u),w+=4}else{if("o"==(F+"").charAt(0))throw console.log("Unknown operation: "+F,r),F;n.push(F)}}}t.x=d,t.y=u,t.nStems=o,t.haveWidth=s,t.width=i,t.open=h};var l=M;function t(h){var r=function(i){function r(r){var t=this,e=(r=h.extend({font:null,value:"",fontSize:64,textAlign:"left"},r)).font,a=r.value,n=r.fontSize,o=r.textAlign,s=function(r,t){var e={};for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&-1===t.indexOf(a)&&(e[a]=r[a]);return e}(r,["font","value","fontSize","textAlign"]);i.call(this,Object.assign({},s,{closed:!0,visible:!1,path:[]})),this.font=e,this._value=a,this._fontSize=n,this._textAlign=o,this.font.waitForLoad().then(function(){t.updateTextPath(),t.visible=!0,t.addTo&&t.addTo.updateRenderGraph()})}i&&(r.__proto__=i);var t={value:{configurable:!0},fontSize:{configurable:!0},textAlign:{configurable:!0}};return((r.prototype=Object.create(i&&i.prototype)).constructor=r).prototype.updateTextPath=function(){this.path=this.font.getTextPath(this.value,this.fontSize,0,0,0,this.textAlign,"bottom"),this.updatePath()},t.value.set=function(r){this._value=r,this.updateTextPath()},t.value.get=function(){return this._value},t.fontSize.set=function(r){this._fontSize=r,this.updateTextPath()},t.fontSize.get=function(){return this._fontSize},t.textAlign.set=function(r){this._textAlign=r,this.updateTextPath()},t.textAlign.get=function(){return this._textAlign},Object.defineProperties(r.prototype,t),r}(h.Shape);return r.optionKeys=r.optionKeys.concat(["font","fontSize","value","textAlign"]),h.Text=r,h}return{init:function(r){return r.FontList=[],r.waitForFonts=function(){return Promise.all(r.FontList.map(function(r){return r.waitForLoad()}))},function(e){function r(r){var t=this;r=e.extend({src:""},r),this.src=r.src,this.font=null,this._hasLoaded=!1,this._loadCallbacks=[],e.FontList.push(this),this._fetchFontResource(this.src).then(function(r){t.font=l.parse(r),t._hasLoaded=!0,t._loadCallbacks.forEach(function(r){return r()})}).catch(function(r){throw new Error("Could not load font from "+t.src+"\n"+r)})}r.prototype.waitForLoad=function(){var e=this;return new Promise(function(r,t){e._hasLoaded&&e._hasLoaded?r():e._loadCallbacks.push(r)})},r.prototype.getFontScale=function(r){return this._hasLoaded?1/this.font.head.unitsPerEm*r:null},r.prototype.measureText=function(r,t){if(void 0===t&&(t=64),!this._hasLoaded)return null;var e=this.font,a=e.hmtx.aWidth,n=l.U.stringToGlyphs(this.font,r),o=this.getFontScale(t),s=e.hhea.descender,i=e.hhea.ascender;e.hhea.lineGap;return{height:(0-s+i)*o,width:n.reduce(function(r,t){return-1<t&&t<a.length&&(r+=a[t]),r},0)*o,descender:s*o,ascender:i*o}},r.prototype.getTextPath=function(r,t,e,a,n,o,s){if(void 0===t&&(t=64),void 0===e&&(e=0),void 0===a&&(a=0),void 0===n&&(n=0),void 0===o&&(o="left"),void 0===s&&(s="bottom"),!this._hasLoaded)return[];var i=l.U.stringToGlyphs(this.font,r),h=l.U.glyphsToPath(this.font,i),f=this.measureText(r,t),d=f.width,u=f.height;f.descender;switch(o){case"right":e-=d;break;case"center":e-=d/2}switch(s){case"top":a-=u;break;case"middle":a-=u/2}return this._convertPathCommands(h,t,e,a,n)},r.prototype._convertPathCommands=function(r,t,e,a,n){void 0===e&&(e=0),void 0===a&&(a=0),void 0===n&&(n=0);var o=this.getFontScale(t),s=r.cmds,i=r.crds.map(function(r){return r*o}),h=0;return s.map(function(r){var t=null;switch(r){case"M":return t={move:{x:e+1*i[h],y:a+-1*i[h+1],z:n}},h+=2,t;case"L":return t={line:{x:e+1*i[h],y:a+-1*i[h+1],z:n}},h+=2,t;case"C":return t={bezier:[{x:e+1*i[h],y:a+-1*i[h+1],z:n},{x:e+1*i[h+2],y:a+-1*i[h+3],z:n},{x:e+1*i[h+4],y:a+-1*i[h+5],z:n}]},h+=6,t;case"Q":return t={arc:[{x:e+1*i[h],y:a+-1*i[h+1],z:n},{x:e+1*i[h+2],y:a+-1*i[h+3],z:n}]},h+=4,t;case"Z":default:return null}}).filter(function(r){return null!==r})},r.prototype._fetchFontResource=function(r){return new Promise(function(t,e){var a=new XMLHttpRequest;a.responseType="arraybuffer",a.open("GET",r,!0),a.onreadystatechange=function(r){4===a.readyState&&(200<=a.status&&a.status<300?t(a.response):e("HTTP Error "+a.status+": "+a.statusText))},a.send(null)})},e.Font=r}(r),t(r),r},version:"1.0.1"}});
//# sourceMappingURL=zfont.min.js.map
